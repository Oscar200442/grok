// ... (den eksisterende kode før denne del forbliver uændret)

// Event listener for TTS Play
ttsPlayBtn.addEventListener('click', async () => {
    const textToSpeak = ttsInput.value.trim();
    if (textToSpeak) {
        try {
            ttsPlayBtn.disabled = true;
            ttsStopBtn.disabled = true;

            const response = await fetch('/api/tts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: textToSpeak })
            });

            if (!response.ok) {
                throw new Error('Fejl ved generering af tale.');
            }

            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            const audio = new Audio(audioUrl);
            
            window.currentAudio = audio;
            audio.play();

            audio.onended = () => {
                ttsPlayBtn.disabled = false;
                ttsStopBtn.disabled = false;
            };

        } catch (error) {
            console.error('Fejl ved afspilning af tale:', error);
            ttsPlayBtn.disabled = false;
            ttsStopBtn.disabled = false;
        }
    }
});

// Event listener for TTS Stop
ttsStopBtn.addEventListener('click', () => {
    if (window.currentAudio) {
        window.currentAudio.pause();
        window.currentAudio.currentTime = 0;
        ttsPlayBtn.disabled = false;
        ttsStopBtn.disabled = false;
    }
});
// ... (resten af din JavaScript-kode)
